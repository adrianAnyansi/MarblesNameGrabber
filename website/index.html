<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <link rel="icon" href="website/marblesonstream.png" type="image/x-icon" />
        <title>Am I In Marbles??</title>
    </head>
    <link rel="stylesheet" type="text/css" href="website/site.css"/>
    <body>
        <p id="Admin_header">
            <span id="admin">ADMIN! </span><span id="debug">DEBUG</span>
            <button id="force_btn">Force</button>
            <button id="stop_btn">Stop</button>
        </p>
        <div class="page trackingPage">
            <h2 class="big-title">Am I in</h2>
            <!-- <img src="website/doom-2016-right.png" id="name_img"> -->
            <h2 class="big-title" id="streamerName">BarbarousKing's</h2>
            <div id="last_title">
                <h2 class="big-title">Marbles?</h2>
                <div style="display:flex; flex-direction: column; align-items: end;">
                    <span id="viewers_visiting">viewers</span>
                    <span id="total_viewer">total visitors</span>
                    <span class="subtitle">version 0.3.2</span>
                </div>
            </div>

            <br/>
            
            <div id="userImgDiv" >
                <p style="font-size: 1em;" class="subtitle userImgBG">Username Image will be displayed here</p>
                <img id="userImg"  src="">
                <div id="currImgDetails">
                    <div><b>Text: </b> <span id="match_text"></span></div>
                    <div><b>Match: </b><span id="match_quality" class="LIKELY match_result"></span></div>
                </div>
                <span id="simUsers" class="subtitle">Similar names: </span>
            </div>
            <div id="username_input_box">
                <input id="username_input" placeholder=" ">
                <p id="username_placeholder">Enter username</p>
            </div>

            <div id="username_output_box">
                <p id="username_feedback"></p> 
                <p id="username_recheck"></p>
                <p id="user_tracked">possible user(s)</p>
            </div>
            <br/>
            <p style="font-size: 0.9em;">
                This website is maintained by @<span style="color:#fdb2b2;">Milotic</span><span style="color:#a0e5ff;">Master</span>. Please don't ask BarbarousKing or Marbles On Stream for details/troubleshooting.
            </p>
        </div>

        <div class="page statusPage">
            <div id="status_bar">
                <div style="flex-grow: 3;">
                    <h2 class="small-title">Status</h2>
                    <div id="screen_demo" class="none">
                        <!-- 24 names are listed here -->
                        <div class="name"></div>
                        <div class="name"></div>
                        <div class="name"></div>
                        <div class="name"></div>
                        <div class="name"></div>
                        <div class="name"></div>
                        <div class="name"></div>
                        <div class="name"></div>
                        <div class="name"></div>
                        <div class="name"></div>
                        <div class="name"></div>
                        <div class="name"></div>
                        <div class="name seen"></div>
                        <div class="name"></div>
                        <div class="name"></div>
                        <div class="name"></div>
                        <div class="name"></div>
                        <div class="name"></div>
                        <div class="name"></div>
                        <div class="name"></div>
                        <div class="name named dashed_bg"></div>
                        <div class="name"></div>
                        <div class="name"></div>
                        <div class="name"></div>
                        <div class="disclaimer">screen not available</div>
                    </div>
                </div>
                <div>
                    <div style="margin-bottom: 0.2em;">
                        <p style="margin-bottom: 0.2em; font-weight: bold;">Server Status: <span id="serverStatusIcon" class="circle_icon unknown"></span> <span id="server_status">Unknown</span></p>
                        <p id="ServerStatusDetails" class="subtitle">Getting server status</p>
                        <p>
                            <div class="hidden"><b>Name recognition:</b> <span id="lag_time"></span> from LIVE</div>
                            <div class="hidden"><b>Started:</b> <span id="ServerStartTime"></span></div>
                            <div class="hidden"><b>Ended:</b> <span id="ServerEndTime"></span></div>
                        </p>
                    </div>
                    <div id="screen_legend">
                        <p style="font-weight: bold;">Screen legend</p>
                        <p><span class="circle_icon seen"></span> Name was seen once</p>
                        <p><span class="circle_icon processing"></span> Text is sent for recognition</p>
                        <p><span class="circle_icon named"></span> Name saved</p>
                        <p><span id="dashed_legend" class="name dashed_bg"></span> Name not visible</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="page aboutPage">
            <h2 class="small-title">About</h2>

            <p class="aboutQuestion"><span>Q: </span>What is this site?</p>

            <p>
                This is a fan site made to track entrants at <a style="color:#ff2c2c;" href="http://twitch.tv/barbarousking">BarbarousKing</a> Marbles-On-Stream event.
            </p>

            <p class="aboutQuestion"><span>Q: </span> Hmm.. how does it work?</p>

            <p>
                To make a long story short, the server is reading the usernames on screen. It's not perfect, but it does a lot.
            </p>
            <p>
                To make a short story long, there's no API and there's a lot of code to scrape and track usernames behind chat and around face-cams.
                Streamlink gets the stream, my code binarizes and tracks the usernames and Tesseract OCR gets the text (best it can.)
            </p>

            <p class="aboutQuestion"><span>Q: </span> Ok but how accurate? Am I in or not?</p>
            <p>
                It's hard to say because every Marbles is different, 
                but generally it's 98% accurate (match to closest username, not per letter) and misses ~20 names through edge cases.
            </p>
            <p>
                Here are the one's I know & am trying to resolve.
            </p>
            <ul>
                <li>Early Names hidden by an alert <i style="color:gray">[Not resolvable]</i></li>
                <li>Bitrate making names unreadable <i style="color:gray">[Gotta guess on this]</i></li>
                <li>Names with many underscores i.e <i>Near_________</i> are sometimes missed by OCR</li>
                <li>Barcode names i.e <i>Il1lI1l</i> are unreadable to the OCR</li>
                <li>Any overlay that obscures a name while it's on screen </li>
            </ul>

            <p class="aboutQuestion"><span>Q: </span>So with all this work; you must know the secret of getting into marbles?</p>

            <p>
                Uhhhh... 
                So the short answer is:
                <ol>
                    <li>Be Early and chat <b>right</b> after the loading screen completes </li>
                    <li>Type <b>!play</b> or <b>!PLAY</b> or <b>!Play</b> or <b>!play #</b> <i>(# can be any single number)</i> </li>
                    <li>Hope the RNG gods smile on you!</li>
                </ol>
            </p>
            <p>
                The technical explaination is: your chat goes to the Twitch IRC servers which is then downloaded onto Barb's machine. However due to
                the massive amount of messages sent during Marbles, the messages no longer arrive in order. So generally your message will make it in,
                but when I have no clue <b>when</b> if it's based on lag to the streamer, ordered, random, etc. 
            </p>

            <p class="aboutQuestion"><span>Q: </span>I'm not in, so the website must be bugged. Who do I talk to?</p>

            <p>
                Just ping @MiloticMaster in Barb's discord or in the #rats-nest. 
            </p>
            <p>
                Thanks for using this! barbLove
            </p>
            <ul>
            <p> Improvements 0.3.1: 
                <li>Increased check FPS from 10 to 30.</li>
                <li>Username movement is now tracked, so server can smartly check unknown usernames 
                    and keep track of ALL users even if only 4 are visible.</li>
                <li>Added tracker for better feedback.</li>
                <li>Many back-end improvments.</li>
            </p>
            <p>
                Improvements 0.2.2: 
                <li>Fixed bug with username search.</li>
                <li>Increased avg accuracy to 98%.</li>
                <li>Added lag from LIVE.</li>
            </p>
            <p>
                Improvements:
                <li> Number of users is more accurate (now Â±30 users).</li>
                <li>Fixed placeholder for user input.</li>
                <li>Username search is slightly more accurate.</li>
            </p>
            </ul>
        </div>

        
        <div class="easter_egg">
            <img src="website/milotic.png"/>
            <p>I fixed it Vove, you happy?</p>
        </div>

    </body>
    <script type="text/javascript" src="website/client.js"></script>
</html>
